var E=(Z,m,D)=>new Promise((F,C)=>{var I=c=>{try{k(D.next(c))}catch(s){C(s)}},M=c=>{try{k(D.throw(c))}catch(s){C(s)}},k=c=>c.done?F(c.value):Promise.resolve(c.value).then(I,M);k((D=D.apply(Z,m)).next())});import{u as ve,A as pe,r as f,c as z,w as V,a as ge,y as j,e as i,f as d,a1 as be,g as t,i as le,j as fe,p as N,F as H,m as q,k as xe,l as h,v as A,t as u,h as g,x as J,ag as G,n as T,ah as ye,b as _e}from"./vendor.77462395.js";import{u as he,a as ke}from"./index.f50df000.js";import we from"./MostBookedHealthCheckups.857a8ae1.js";import"./carousel.a9d90545.js";const Se={key:0,class:"flex justify-center items-center h-60"},Ce={key:1},Ie={class:"container"},Pe={class:"py-4 row"},$e={class:"col-12 col-md-6 mb-2"},Ne={class:"flex justify-between items-center mb-4"},Ae={key:0},De={class:"font-semibold text-[#001D55]"},Me={class:"text-gray-500"},Ve={class:"line-through"},Te={class:"font-semibold text-[#001D55] ml-1"},Oe=["onClick"],Re={key:1,class:"text-gray-500"},Ue={class:"col-12 col-md-6"},Be={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},Ee={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},je={class:"relative w-full min-h-[40px]"},He={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},qe=["disabled"],Fe=["value"],Le={key:0,class:"text-sm font-semibold mb-2 mt-2"},ze=["onUpdate:modelValue","onInput"],Je={key:1,class:"text-xs text-red-500 mt-1"},Ge={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ze=["onUpdate:modelValue","onInput"],Qe={key:0,class:"text-xs text-red-500 mt-1"},Ye=["onUpdate:modelValue","onChange"],Ke={key:0,class:"text-xs text-red-500 mt-1"},We={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Xe={key:0,class:"text-xs text-red-500 mt-1"},et={key:0,class:"text-xs text-red-500 mt-1"},tt={key:0,class:"text-xs text-red-500 mt-1"},st={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},lt=["min"],at={key:0,class:"text-xs text-red-500 mt-1"},ot=["disabled"],rt=["value"],nt={key:0,class:"text-xs text-red-500 mt-1"},it={class:"flex items-center text-sm text-gray-700"},dt={class:"mt-3"},ut={key:0},ct={key:1},mt={class:"mt-2 text-lg font-semibold text-[#001D55]"},vt={class:"flex justify-center"},pt=["disabled"],gt={key:0,class:"mt-3 text-center"},bt=300,ae=200,oe=75,St={__name:"CartPage",setup(Z){const m=he(),D=ve(),F=pe();D.params.orderId;const C=f(!0),I=f(!1),M=f(!1),k=f(""),c=f([{name:"",age:"",gender:""}]),s=f({}),x=f({text:"",type:""}),y=f(""),_=f(""),o=f({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),L=z(()=>m.cartItems.reduce((l,e)=>l+Number(e.discounted_price||0),0)),Q=z(()=>{let l=L.value;return l<bt&&(l+=ae),o.value.printedReports&&(l+=oe),Math.round(l)}),Y=f(0);V(Q,l=>Y.value=l,{immediate:!0}),V(k,l=>{const e=Number(l);c.value=Array.from({length:e||1},()=>({name:"",age:"",gender:""}))}),V(c,l=>{l.forEach((e,n)=>{e.name=e.name.replace(/[^a-zA-Z\s]/g,""),["name","age","gender"].forEach(a=>{e[a]&&delete s.value[`${a}_${n}`]})})},{deep:!0});const O=f([]),re=f(new Date().toISOString().split("T")[0]),K=(()=>{const l=[],e=new Date;e.setHours(5,30,0,0);const n=new Date;for(n.setHours(18,30,0,0);e<n;){const a=new Date(e.getTime()+30*6e4),r=v=>v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});l.push(`${r(e)} - ${r(a)}`),e.setTime(a.getTime())}return l})();V(()=>o.value.date,l=>{if(!l){O.value=[],o.value.timeSlot="";return}const e=new Date(l),n=new Date;if(e.toDateString()===n.toDateString()){const r=new Date;O.value=K.filter(v=>{const[P]=v.split(" - "),[$,w]=P.split(" ");let[b,B]=$.split(":").map(Number);w==="PM"&&b!==12&&(b+=12),w==="AM"&&b===12&&(b=0);const R=new Date;return R.setHours(b,B,0,0),R>r})}else O.value=[...K];o.value.timeSlot=""});const ne=l=>{const n=l.target.value.replace(/\D/g,"");o.value.pincode=n,n?n.length<6?(s.value.pincode="Pincode must be 6 digits.",y.value="",_.value=""):n.length>6?(s.value.pincode="Pincode cannot exceed 6 digits.",y.value="",_.value="error"):(delete s.value.pincode,y.value="",_.value=""):(s.value.pincode="Please enter pincode.",y.value="",_.value="")},ie=l=>{const e=l.target.value;o.value.address=e;const n=e.trim();n?n.length<25?s.value.address="Address must be at least 25 characters.":delete s.value.address:s.value.address="Please enter your address."},de=l=>{let e=c.value[l].age.toString();if(e==="-"){s.value[`age_${l}`]="Negative numbers are not allowed";return}const n=Number(e);e?isNaN(n)?s.value[`age_${l}`]="Age must be a number.":n<0?(s.value[`age_${l}`]="Negative numbers are not allowed",c.value[l].age=""):n>100?s.value[`age_${l}`]="Age should be a number between 0 and 100":delete s.value[`age_${l}`]:s.value[`age_${l}`]="Age is required."};V(()=>o.value.email,l=>{const e=l.trim();e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?delete s.value.email:s.value.email="Please enter a valid email address (example@domain.com).":s.value.email="Please enter your email."}),V(()=>o.value.mobile,l=>{const e=l.trim();e?/^[6-9]\d{9}$/.test(e)?delete s.value.mobile:s.value.mobile="Please enter a valid Indian mobile number.":s.value.mobile="Please enter your mobile number."});const ue=l=>{const e=l.target.value.replace(/\D/g,"");o.value.mobile=e,e?/^[6-9]\d{0,9}$/.test(e)?e.length>10?s.value.mobile="Mobile number cannot exceed 10 digits.":e.length<10?s.value.mobile="Mobile number must be 10 digits.":delete s.value.mobile:s.value.mobile="Please enter a valid Indian mobile number.":s.value.mobile="Please enter your mobile number."},U=l=>delete s.value[l],ce=()=>{var r,v,P,$;s.value={};const l=o.value,e=(r=l.pincode)==null?void 0:r.trim();e?/^\d{6}$/.test(e)||(s.value.pincode="Pincode must be 6 digits."):s.value.pincode="Please enter pincode.",c.value.forEach((w,b)=>{w.name?/^[A-Za-z\s]+$/.test(w.name)||(s.value[`name_${b}`]="Name must contain only letters."):s.value[`name_${b}`]="Name is required.",w.age||(s.value[`age_${b}`]="Age is required."),w.gender||(s.value[`gender_${b}`]="Gender is required.")}),l.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||(s.value.email="Invalid email address."):s.value.email="Please enter your email.";const n=(v=l.mobile)==null?void 0:v.trim();n?/^[6-9]\d{9}$/.test(n)||(s.value.mobile="Invalid Indian mobile number."):s.value.mobile="Please enter your mobile number.";const a=(P=l.address)==null?void 0:P.trim();return a?a.length<25&&(s.value.address="Address must be at least 25 characters."):s.value.address="Please enter your address.",l.date||(s.value.date="Please select date."),l.timeSlot||(s.value.timeSlot="Please select time slot."),(($=m.cartItems)==null?void 0:$.length)||(x.value={text:"No items in cart to book.",type:"error"}),!Object.keys(s.value).length&&(!x.value.text||x.value.type!=="error")},W=()=>E(this,null,function*(){var e,n;const l=o.value.pincode.trim();if(y.value="",_.value="",!/^\d{6}$/.test(l)){y.value="Enter valid 6 digit pincode first.",_.value="error";return}M.value=!0;try{const{data:a}=yield j.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:l}}),r=a==null?void 0:a.message;y.value=(r==null?void 0:r.message)||"Response received",_.value=(r==null?void 0:r.status)||"success"}catch(a){console.error("Error checking pincode:",a),y.value=((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.message)||"Unable to check availability.",_.value="error"}finally{M.value=!1}});z(()=>m.cartItems.reduce((l,e)=>l+Number(e.actual_price||0),0));const me=()=>E(this,null,function*(){var $,w,b,B,R,X,ee,te,se;if(x.value={text:"",type:""},!ce()){x.value={text:"Please fix the errors above.",type:"error"};return}if(_.value!=="success"&&(yield W(),_.value!=="success")){x.value={text:y.value||"Home collection not available for this pincode.",type:"error"};return}const l=ke();l.loadScannedId();const e=l.scannedId,n=p=>p?Number(String(p).replace(/,/g,"")):0,a=m.cartItems.reduce((p,S)=>p+n(S.actual_price),0),r=m.cartItems.reduce((p,S)=>p+n(S.discounted_price),0),v=a>r?a-r:0,P={customer_name:(($=c.value[0])==null?void 0:$.name)||"",age:((w=c.value[0])==null?void 0:w.age)||"",gender:((b=c.value[0])==null?void 0:b.gender)||"",email:o.value.email,mobile_number:o.value.mobile,address:o.value.address,pincode:o.value.pincode,appointment_date:o.value.date,appointment_time:o.value.timeSlot,number_of_persons:Number(k.value)||c.value.length||1,hard_copy_required:o.value.printedReports?1:0,total_item_price:a,total_price:Number(Y.value||0),discount:v,ordered_items:JSON.parse(JSON.stringify(m.cartItems)),customer_details:JSON.parse(JSON.stringify(c.value)),home_collection:o.value.homeCollection?1:0};e&&(P.affiliated_id=e),I.value=!0,C.value=!0;try{const p=yield j.post("/api/method/bloodtestnearme.api.order_api.create_order",P),S=(X=(R=(B=p.data)==null?void 0:B.message)!=null?R:p.data)!=null?X:{};if(S.status==="success"&&S.order_id){(ee=m.clearCart)==null||ee.call(m),F.replace({name:"ThankYou",state:{orderId:S.order_id}});return}x.value={text:(S==null?void 0:S.message)||"Failed to create order.",type:"error"}}catch(p){console.error("Order creation error:",p),x.value={text:((se=(te=p==null?void 0:p.response)==null?void 0:te.data)==null?void 0:se.message)||"Server error occurred.",type:"error"}}finally{I.value=!1,C.value=!1}});return ge(()=>E(this,null,function*(){try{yield Promise.all([j.get("/api/method/bloodtestnearme.api.packages.get_individual_packages"),j.get("/api/method/bloodtestnearme.api.packages.get_package_based_tests")])}catch(l){console.error("Error fetching packages:",l)}finally{C.value=!1}})),(l,e)=>{const n=_e("router-link");return C.value?(i(),d("div",Se,[...e[10]||(e[10]=[be('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading cart details...</p></div>',1)])])):(i(),d("div",Ce,[t("div",Ie,[t("div",Pe,[t("div",$e,[t("div",Ne,[e[12]||(e[12]=t("h5",{class:"text-[#001D55] font-semibold"},"Cart Items",-1)),le(n,{to:"/book-blood-tests",class:"flex items-center text-red-700 font-medium no-underline hover:underline-offset-2"},{default:fe(()=>[...e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 mr-1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})],-1),T(" Add more tests ",-1)])]),_:1})]),e[13]||(e[13]=t("hr",{class:"border-gray-300 mb-3"},null,-1)),N(m).cartItems&&N(m).cartItems.length?(i(),d("div",Ae,[(i(!0),d(H,null,q(N(m).cartItems,(a,r)=>(i(),d("div",{key:r,class:"flex justify-between items-center mb-3 rounded-lg"},[t("div",null,[t("h6",De,u(a.name1),1),t("div",Me,[t("span",Ve,"\u20B9 "+u(a.actual_price),1),t("span",Te,"\u20B9 "+u(a.discounted_price),1)])]),t("button",{onClick:v=>N(m).removeFromCart(a.name1),class:"bg-[#0040BB] text-white px-4 py-2 rounded-full hover:bg-[#002F8E] transition"}," Remove ",8,Oe)]))),128))])):(i(),d("p",Re,"No items in the cart."))]),t("div",Ue,[t("div",Be,[t("form",{class:"space-y-2 bold-test-color",onSubmit:xe(me,["prevent"])},[t("div",Ee,[t("div",je,[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.pincode=a),onInput:ne,type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[A,o.value.pincode]]),s.value.pincode?(i(),d("p",He,u(s.value.pincode),1)):g("",!0),y.value?(i(),d("p",{key:1,class:J(["absolute text-[11px] mt-[2px]",_.value==="success"?"text-green-600":"text-red-500"])},u(y.value),3)):g("",!0)]),t("button",{type:"button",onClick:W,disabled:M.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},u(M.value?"Checking...":"Check Availability"),9,qe)]),t("div",null,[h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[14]||(e[14]=t("option",{disabled:"",value:""},"Select Number of Person *",-1)),(i(),d(H,null,q(10,a=>t("option",{key:a,value:a},u(a),9,Fe)),64))],512),[[G,k.value]]),e[16]||(e[16]=t("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests will be added for all persons. ",-1)),(i(!0),d(H,null,q(c.value,(a,r)=>(i(),d("div",{key:r,class:"border p-1 rounded-md bg-gray-50 mb-2"},[k.value&&k.value>1?(i(),d("h6",Le," Person "+u(r+1),1)):g("",!0),h(t("input",{"onUpdate:modelValue":v=>a.name=v,onInput:v=>U(`name_${r}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,ze),[[A,a.name]]),s.value[`name_${r}`]?(i(),d("p",Je,u(s.value[`name_${r}`]),1)):g("",!0),t("div",Ge,[t("div",null,[h(t("input",{"onUpdate:modelValue":v=>a.age=v,onInput:v=>de(r),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Ze),[[A,a.age]]),s.value[`age_${r}`]?(i(),d("p",Qe,u(s.value[`age_${r}`]),1)):g("",!0)]),t("div",null,[h(t("select",{"onUpdate:modelValue":v=>a.gender=v,onChange:v=>U(`gender_${r}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[15]||(e[15]=[t("option",{disabled:"",value:""},"Select Gender *",-1),t("option",null,"Male",-1),t("option",null,"Female",-1),t("option",null,"Others",-1)])],40,Ye),[[G,a.gender]]),s.value[`gender_${r}`]?(i(),d("p",Ke,u(s.value[`gender_${r}`]),1)):g("",!0)])])]))),128))]),t("div",We,[t("div",null,[h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.email=a),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,512),[[A,o.value.email]]),s.value.email?(i(),d("p",Xe,u(s.value.email),1)):g("",!0)]),t("div",null,[h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.mobile=a),onInput:ue,type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full",maxlength:"10",inputmode:"numeric"},null,544),[[A,o.value.mobile]]),s.value.mobile?(i(),d("p",et,u(s.value.mobile),1)):g("",!0)])]),t("div",null,[h(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.address=a),onInput:ie,rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[A,o.value.address]]),s.value.address?(i(),d("p",tt,u(s.value.address),1)):g("",!0)]),e[23]||(e[23]=t("div",{class:"flex items-center justify-center gap-2"},[t("span",{class:"font-semibold text-sm"},"Collection Type:"),t("label",{class:"flex items-center gap-2 text-sm cursor-not-allowed"},[t("input",{type:"checkbox",checked:"",disabled:"",class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"}),T(" Home Collection ")])],-1)),t("div",st,[t("div",null,[h(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.date=a),onChange:e[6]||(e[6]=a=>U("date")),min:re.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,lt),[[A,o.value.date]]),s.value.date?(i(),d("p",at,u(s.value.date),1)):g("",!0)]),t("div",null,[h(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.timeSlot=a),onChange:e[8]||(e[8]=a=>U("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!O.value.length},[e[17]||(e[17]=t("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(i(!0),d(H,null,q(O.value,(a,r)=>(i(),d("option",{key:r,value:a},u(a),9,rt))),128))],40,ot),[[G,o.value.timeSlot]]),s.value.timeSlot?(i(),d("p",nt,u(s.value.timeSlot),1)):g("",!0)])]),t("div",null,[t("div",it,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=a=>o.value.printedReports=a),class:"mr-2"},null,512),[[ye,o.value.printedReports]]),e[18]||(e[18]=t("span",{class:"text-red-500"},"Additional Rs. 75 for Printed Reports",-1))]),t("div",dt,[t("p",null,[e[19]||(e[19]=t("strong",null,"Test/Package Price:",-1)),T(" \u20B9"+u(L.value),1)]),N(m).cartItems.length>0&&L.value<300?(i(),d("p",ut,[e[20]||(e[20]=t("strong",null,"Home Collection Charge:",-1)),T(" \u20B9"+u(ae))])):g("",!0),o.value.printedReports?(i(),d("p",ct,[e[21]||(e[21]=t("strong",null,"Printed Report Charge:",-1)),T(" \u20B9"+u(oe))])):g("",!0),t("p",mt,[e[22]||(e[22]=t("strong",null,"Total Amount:",-1)),T(" \u20B9"+u(Q.value),1)])])]),t("div",vt,[t("button",{type:"submit",disabled:N(m).cartItems.length===0||I.value,class:J(["px-20 py-2 rounded-full transition w-full sm:w-auto",N(m).cartItems.length===0||I.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"global-bg-color text-white"])},u(I.value?"Booking...":"Book Now"),11,pt)]),x.value.text?(i(),d("div",gt,[t("p",{class:J(x.value.type==="success"?"text-green-600":"text-red-600")},u(x.value.text),3)])):g("",!0)],32)])])])]),le(we)]))}}};export{St as default};
