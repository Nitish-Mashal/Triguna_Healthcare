var B=(z,A,I)=>new Promise((v,P)=>{var N=b=>{try{f(I.next(b))}catch(y){P(y)}},S=b=>{try{f(I.throw(b))}catch(y){P(y)}},f=b=>b.done?v(b.value):Promise.resolve(b.value).then(N,S);f((I=I.apply(z,A)).next())});import{u as fe,A as be,r as p,w as V,a as ye,c as he,e as d,f as u,a1 as _e,g as a,t as n,k as xe,l as _,v as C,h as g,x as ke,ag as F,F as j,m as q,n as U,ah as we,i as Se,y as L}from"./vendor.77462395.js";import{a as Pe}from"./index.f50df000.js";import $e from"./MostBookedHealthCheckups.857a8ae1.js";import"./carousel.a9d90545.js";const Ce={key:0,class:"flex justify-center items-center h-60"},Ae={key:1},Ie={class:"container"},Ne={class:"py-4 row"},Te={class:"col-12 col-md-6 mb-2"},Ve={class:"bold-test-color pb-2"},De={class:"bold-test-color d-none d-md-block"},Re=["innerHTML"],Me={class:"pt-4"},Ue={class:"text-red-600"},Ee={class:"col-12 col-md-6"},He={class:"p-3 border-0 shadow-sm rounded-xl bg-gray-50"},Be={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-start"},Le={class:"relative w-full min-h-[40px]"},Oe={key:0,class:"absolute text-[11px] text-red-500 mt-[2px]"},Fe=["disabled"],je=["value"],qe={key:0,class:"text-sm font-semibold mb-2 mt-2"},ze=["onUpdate:modelValue","onInput"],Ye={key:1,class:"text-xs text-red-500 mt-1"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ge=["onUpdate:modelValue","onInput"],Je={key:0,class:"text-xs text-red-500 mt-1"},Qe=["onUpdate:modelValue","onChange"],Ke={key:0,class:"text-xs text-red-500 mt-1"},We={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Xe={key:0,class:"text-xs text-red-500 mt-1"},et={key:0,class:"text-xs text-red-500 mt-1"},tt={key:0,class:"text-xs text-red-500 mt-1"},at={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},st=["min"],lt={key:0,class:"text-xs text-red-500 mt-1"},ot=["disabled"],rt=["value"],nt={key:0,class:"text-xs text-red-500 mt-1"},it={class:"flex items-center text-sm text-gray-700"},dt={class:"mt-3"},ut={key:0},ct={key:1},mt={class:"mt-2 text-lg font-semibold text-[#001D55]"},pt={key:0,class:"mt-3 text-center"},vt={class:"text-green-600"},xt={__name:"SinglePackageBook",setup(z){const A=fe(),I=be();decodeURIComponent(A.params.slug);const v=p({}),P=p(!0),N=p(0),S=p(""),f=p(""),b=p(!1),y=p(""),T=p(""),h=p([{name:"",age:"",gender:""}]);V(T,l=>{const e=Number(l);if(!e){h.value=[{name:"",age:"",gender:""}];return}h.value=Array.from({length:e},()=>({name:"",age:"",gender:""}))});const o=p({pincode:"",email:"",mobile:"",address:"",date:"",timeSlot:"",homeCollection:!1,printedReports:!1}),s=p({}),D=p([]),re=new Date().toISOString().split("T")[0],ne=p(re),E=p(200),Y=p(75),Z=(()=>{const l=[],e=new Date;e.setHours(5,30,0,0);const t=new Date;for(t.setHours(18,30,0,0);e<t;){const r=new Date(e.getTime()+30*6e4),i=c=>c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});l.push(`${i(e)} - ${i(r)}`),e.setTime(r.getTime())}return l})();V(()=>o.value.date,l=>{if(!l){D.value=[],o.value.timeSlot="";return}const e=new Date(l),t=new Date;if(e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()){const r=new Date;D.value=Z.filter(i=>{const c=new Date,[m]=i.split(" - "),[x,k]=m.split(" ");let[w,R]=x.split(":").map(Number);return k==="PM"&&w!==12&&(w+=12),k==="AM"&&w===12&&(w=0),c.setHours(w,R,0,0),c>r})}else D.value=[...Z];o.value.timeSlot=""});const ie=()=>B(this,null,function*(){var l,e,t;P.value=!0;try{const r=A.params.url||A.params.slug||A.params.id;if(r)try{const m=(l=(yield L.get("/api/method/bloodtestnearme.api.packages.get_packages",{params:{url:decodeURIComponent(r)}})).data)==null?void 0:l.message,x=Array.isArray(m==null?void 0:m.data)&&m.data.length?m.data[0]:(m==null?void 0:m.data)||m;if(x){v.value=x,N.value=parseFloat(x.discounted_price||0)+E.value,G(x);return}else console.warn("\u26A0\uFE0F No data found using URL param:",r)}catch(c){console.warn("\u26A0\uFE0F URL-based API failed, falling back to full fetch.")}const i=["/api/method/bloodtestnearme.api.packages.get_package_based_tests","/api/method/bloodtestnearme.api.packages.get_individual_packages"];for(const c of i){const k=(((t=(e=(yield L.get(c)).data)==null?void 0:e.message)==null?void 0:t.data)||[]).find(w=>{var M;return((M=w.name1)==null?void 0:M.toLowerCase().replace(/\s+/g,"-"))===(r==null?void 0:r.toLowerCase())});if(k){v.value=k,N.value=parseFloat(k.discounted_price||0)+E.value,G(k);break}}}catch(r){console.error("\u274C Error fetching package details:",r)}finally{P.value=!1}}),G=l=>{document.title=l.title||l.package_name||l.name1||"Triguna Healthcare - Health Packages";let e=document.querySelector("meta[name='description']");e||(e=document.createElement("meta"),e.name="description",document.head.appendChild(e)),e.setAttribute("content",l.meta_description||l.short_description||`Book ${l.package_name||"this health checkup"} at home easily with Triguna Healthcare.`)},de=()=>B(this,null,function*(){var t,r,i,c,m,x,k,w,R,M,K,W,X;if(y.value="",s.value={},!pe()){y.value="Please fix the highlighted errors before submitting.";return}if(!(f.value==="success"||(yield J(!0)))){y.value="Please enter a valid pincode before booking.";return}P.value=!0;try{const $=Pe();$.loadScannedId();const ee=$.scannedId,te=oe=>oe?Number(String(oe).replace(/,/g,"")):0,O=te((t=v.value)==null?void 0:t.actual_price),ae=te((r=v.value)==null?void 0:r.discounted_price),ve=O>ae?O-ae:0;let se={customer_name:((i=h.value[0])==null?void 0:i.name)||"",age:((c=h.value[0])==null?void 0:c.age)||"",gender:((m=h.value[0])==null?void 0:m.gender)||"",email:o.value.email,mobile_number:o.value.mobile,address:o.value.address,pincode:o.value.pincode,appointment_date:o.value.date,appointment_time:o.value.timeSlot,number_of_persons:T.value||1,hard_copy_required:o.value.printedReports?1:0,total_item_price:O,total_price:Number(N.value||0),discount:ve,ordered_items:[v.value],customer_details:h.value};ee&&(se.affiliated_id=ee);const ge=JSON.parse(JSON.stringify(se)),le=yield L.post("/api/method/bloodtestnearme.api.order_api.create_order",ge),H=(w=(k=(x=le.data)==null?void 0:x.message)!=null?k:le.data)!=null?w:{};if(H.status==="success"&&H.order_id){I.replace({name:"ThankYou",state:{orderId:H.order_id}});return}y.value=H.message||"Failed to create order. Please try again."}catch($){console.error("API ERROR:",((R=$.response)==null?void 0:R.data)||$),y.value=((K=(M=$.response)==null?void 0:M.data)==null?void 0:K.message)||((X=(W=$.response)==null?void 0:W.data)==null?void 0:X.exc)||"Server error occurred."}finally{P.value=!1}}),J=(l=!1)=>B(this,null,function*(){var t,r;const e=(t=o.value.pincode)==null?void 0:t.trim();if(!e&&l)return s.value.pincode="Please enter your pincode before booking.",!1;if(!/^\d{6}$/.test(e))return s.value.pincode="Pincode must be 6 digits.",!1;S.value="",f.value="",b.value=!0;try{const c=(r=(yield L.get("/api/method/bloodtestnearme.api.pincodes_api.getby_pincodes",{params:{pincode:e}})).data)==null?void 0:r.message;c?(S.value=c.message||"",f.value=c.status||"error"):(S.value="Unexpected API response format.",f.value="error")}catch(i){console.error("Error checking pincode:",i),S.value="Unable to check availability at the moment.",f.value="error"}finally{b.value=!1}return f.value==="success"});ye(ie),V(()=>o.value.pincode,l=>{const e=l.replace(/\D/g,"");l!==e&&(o.value.pincode=e),S.value="",f.value="",e?e.length!==6?s.value.pincode="Pincode must be 6 digits.":delete s.value.pincode:s.value.pincode="Please enter pincode."}),V(()=>o.value.email,l=>{l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?delete s.value.email:s.value.email="Please enter a valid email address (example@domain.com).":s.value.email="Please enter your email."});const ue=l=>{let e=l.target.value.replace(/\D/g,"");e.length>10&&(e=e.slice(0,10)),o.value.mobile=e,e?/^[6-9]/.test(e)?e.length<10?s.value.mobile="Mobile number must be exactly 10 digits.":delete s.value.mobile:s.value.mobile="Please enter a valid Indian mobile number.":s.value.mobile="Please enter your mobile number."},ce=l=>{const e=l.target.value;o.value.address=e,e.trim()?e.trim().length<25?s.value.address="Address must be at least 25 characters long.":delete s.value.address:s.value.address="Please enter your address."},me=l=>{let e=h.value[l].age.toString();if(e==="-"){s.value[`age_${l}`]="Negative numbers are not allowed";return}const t=Number(e);e?isNaN(t)?s.value[`age_${l}`]="Age must be a number.":t<0?(s.value[`age_${l}`]="Negative numbers are not allowed",h.value[l].age=""):t>100?s.value[`age_${l}`]="Age should be a number between 0 and 100":delete s.value[`age_${l}`]:s.value[`age_${l}`]="Age is required."};V(h,l=>{l.forEach((e,t)=>{e.name&&/[^a-zA-Z\s]/.test(e.name)&&(e.name=e.name.replace(/[^a-zA-Z\s]/g,"")),e.name&&delete s.value[`name_${t}`],e.age&&delete s.value[`age_${t}`],e.gender&&delete s.value[`gender_${t}`]})},{deep:!0});const pe=()=>{s.value={},o.value.pincode?/^\d{6}$/.test(o.value.pincode)||(s.value.pincode="Pincode must be 6 digits."):s.value.pincode="Please enter pincode.",h.value.forEach((t,r)=>{t.name?/^[A-Za-z\s]+$/.test(t.name)||(s.value[`name_${r}`]="Name must contain only letters."):s.value[`name_${r}`]="Name is required.",t.age?(t.age<0||t.age>100)&&(s.value[`age_${r}`]="Age should be a number between 0 and 100"):s.value[`age_${r}`]="Age is required.",t.gender||(s.value[`gender_${r}`]="Gender is required.")}),o.value.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value.email)||(s.value.email="Please enter a valid email address."):s.value.email="Please enter your email.";const l=o.value.mobile.trim();l?/^[6-9]\d{9}$/.test(l)||(s.value.mobile="Invalid Indian mobile number."):s.value.mobile="Please enter your mobile number.";const e=o.value.address.trim();return e?e.length<25&&(s.value.address="Address must be at least 25 characters."):s.value.address="Please enter your address.",o.value.date||(s.value.date="Please select your date."),o.value.timeSlot||(s.value.timeSlot="Please select your time slot."),Object.keys(s.value).length===0},Q=he(()=>{const l=parseFloat(v.value.discounted_price||0);let e=l;return l<300&&(e+=E.value),o.value.printedReports&&(e+=Y.value),e});return V(Q,l=>N.value=l),(l,e)=>P.value?(d(),u("div",Ce,[...e[12]||(e[12]=[_e('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-[#001D55]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg><p class="text-[#001D55] mt-3 font-semibold">Loading package details...</p></div>',1)])])):(d(),u("div",Ae,[a("div",Ie,[a("div",Ne,[a("div",Te,[a("h4",Ve,n(v.value.name1)+" ("+n(v.value.number_of_test)+" Tests) ",1),a("div",De,[a("div",{class:"pt-2",innerHTML:v.value.description},null,8,Re),a("div",Me,[e[13]||(e[13]=a("strong",null,"Sample Type: ",-1)),a("span",Ue,n(v.value.sample_type),1)])])]),a("div",Ee,[a("div",He,[a("form",{onSubmit:xe(de,["prevent"]),class:"space-y-2 bold-test-color"},[a("div",Be,[a("div",Le,[_(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.pincode=t),onInput:e[1]||(e[1]=t=>l.clearError("pincode")),type:"text",placeholder:"Pincode *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[C,o.value.pincode]]),s.value.pincode?(d(),u("p",Oe,n(s.value.pincode),1)):g("",!0),S.value?(d(),u("p",{key:1,class:ke(["absolute text-[11px] mt-[2px]",f.value==="success"?"text-green-600":"text-red-500"])},n(S.value),3)):g("",!0)]),a("button",{type:"button",onClick:J,disabled:b.value,class:"bg-gray-200 text-gray-700 text-sm px-3 py-[1px] rounded-md hover:bg-gray-300 transition h-[28px] sm:h-[30px] self-start disabled:opacity-60 disabled:cursor-not-allowed"},n(b.value?"Checking...":"Check Availability"),9,Fe)]),a("div",null,[_(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),class:"border rounded-md px-3 py-1 text-sm w-full"},[e[14]||(e[14]=a("option",{disabled:"",value:""},"Select Number of Person *",-1)),(d(),u(j,null,q(10,t=>a("option",{key:t,value:t},n(t),9,je)),64))],512),[[F,T.value]]),e[16]||(e[16]=a("div",{class:"text-xs text-red-500 mb-2 mt-2"}," Note: Same set of tests/packages will be added for all persons. ",-1)),(d(!0),u(j,null,q(h.value,(t,r)=>(d(),u("div",{key:r,class:"border p-1 rounded-md bg-gray-50 mb-2"},[T.value&&T.value>1?(d(),u("h6",qe," Person "+n(r+1),1)):g("",!0),_(a("input",{"onUpdate:modelValue":i=>t.name=i,onInput:i=>l.clearError(`name_${r}`),type:"text",placeholder:"Beneficiary Name *",class:"border rounded-md px-3 py-[1px] text-sm w-full mb-2"},null,40,ze),[[C,t.name]]),s.value[`name_${r}`]?(d(),u("p",Ye,n(s.value[`name_${r}`]),1)):g("",!0),a("div",Ze,[a("div",null,[_(a("input",{"onUpdate:modelValue":i=>t.age=i,onInput:i=>me(r),type:"number",placeholder:"Age *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,Ge),[[C,t.age]]),s.value[`age_${r}`]?(d(),u("p",Je,n(s.value[`age_${r}`]),1)):g("",!0)]),a("div",null,[_(a("select",{"onUpdate:modelValue":i=>t.gender=i,onChange:i=>l.clearError(`gender_${r}`),class:"border rounded-md px-3 py-1 text-sm w-full"},[...e[15]||(e[15]=[a("option",{disabled:"",value:""},"Select Gender *",-1),a("option",null,"Male",-1),a("option",null,"Female",-1),a("option",null,"Others",-1)])],40,Qe),[[F,t.gender]]),s.value[`gender_${r}`]?(d(),u("p",Ke,n(s.value[`gender_${r}`]),1)):g("",!0)])])]))),128))]),a("div",We,[a("div",null,[_(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.email=t),onInput:e[4]||(e[4]=t=>l.clearError("email")),type:"email",placeholder:"Email *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[C,o.value.email]]),s.value.email?(d(),u("p",Xe,n(s.value.email),1)):g("",!0)]),a("div",null,[_(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.mobile=t),onInput:ue,type:"tel",placeholder:"Mobile (Indian Number Only) *",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,544),[[C,o.value.mobile]]),s.value.mobile?(d(),u("p",et,n(s.value.mobile),1)):g("",!0)])]),a("div",null,[_(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.address=t),onInput:ce,rows:"2",class:"border rounded-md px-3 py-[1px] text-sm w-full",placeholder:"Complete Address *"},null,544),[[C,o.value.address]]),s.value.address?(d(),u("p",tt,n(s.value.address),1)):g("",!0)]),e[23]||(e[23]=a("div",{class:"flex items-center justify-center gap-2"},[a("span",{class:"font-semibold text-sm"},"Collection Type:"),a("label",{class:"flex items-center gap-2 text-sm cursor-not-allowed"},[a("input",{type:"checkbox",checked:"",disabled:"",class:"w-4 h-4 appearance-none border border-gray-400 rounded-full checked:bg-[#001D55] checked:border-[#001D55] transition duration-200"}),U(" Home Collection ")])],-1)),a("div",at,[a("div",null,[_(a("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.date=t),onChange:e[8]||(e[8]=t=>l.clearError("date")),min:ne.value,type:"date",class:"border rounded-md px-3 py-[1px] text-sm w-full"},null,40,st),[[C,o.value.date]]),s.value.date?(d(),u("p",lt,n(s.value.date),1)):g("",!0)]),a("div",null,[_(a("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.timeSlot=t),onChange:e[10]||(e[10]=t=>l.clearError("timeSlot")),class:"border rounded-md px-3 py-1 text-sm w-full",disabled:!D.value.length},[e[17]||(e[17]=a("option",{disabled:"",value:""},"Select Preferred Time Slot *",-1)),(d(!0),u(j,null,q(D.value,(t,r)=>(d(),u("option",{key:r,value:t},n(t),9,rt))),128))],40,ot),[[F,o.value.timeSlot]]),s.value.timeSlot?(d(),u("p",nt,n(s.value.timeSlot),1)):g("",!0)])]),a("div",null,[a("div",it,[_(a("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>o.value.printedReports=t),id:"printedReports",class:"mr-2"},null,512),[[we,o.value.printedReports]]),e[18]||(e[18]=a("label",{for:"printedReports",class:"text-red-500"}," Additional Rs. 75 for Printed Reports ",-1))]),a("div",dt,[a("p",null,[e[19]||(e[19]=a("strong",null,"Test/Package Price:",-1)),U(" \u20B9"+n(v.value.discounted_price),1)]),v.value.discounted_price<300?(d(),u("p",ut,[e[20]||(e[20]=a("strong",null,"Home Collection Charge:",-1)),U(" \u20B9"+n(E.value),1)])):g("",!0),o.value.printedReports?(d(),u("p",ct,[e[21]||(e[21]=a("strong",null,"Printed Report Charge:",-1)),U(" \u20B9"+n(Y.value),1)])):g("",!0),a("p",mt,[e[22]||(e[22]=a("strong",null,"Total Amount:",-1)),U(" \u20B9"+n(Q.value),1)])])]),e[24]||(e[24]=a("div",{class:"flex justify-center"},[a("button",{type:"submit",class:"global-bg-color text-white px-20 py-2 rounded-full hover:bg-blue-700 transition w-full sm:w-auto"}," Book Now ")],-1)),y.value?(d(),u("div",pt,[a("p",vt,n(y.value),1)])):g("",!0)],32)])])])]),Se($e)]))}};export{xt as default};
